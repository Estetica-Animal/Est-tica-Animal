<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Est√©tica Animal ‚Äî Agenda & Financeiro</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Flatpickr CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<style>
  :root{
    --rosa:#ff66a3;
    --rosa-escuro:#ff3385;
    --bg:#fff0f6;
    --card:#ffffff;
    --texto:#444;
    --sombra:0 4px 8px rgba(255,102,163,.3);
    --azul:#007bff;
    --verde:#28a745;
    --cinza:#d6d6d6;
  }
  *{box-sizing:border-box}
  body{font-family:Arial,Helvetica,sans-serif; background:var(--bg); color:var(--texto); margin:0;}
  
  header{position:fixed; top:0; left:0; right:0; background:var(--rosa); color:#fff; z-index:1000; box-shadow:var(--sombra);}
  .header-inner{max-width:1200px; margin:0 auto; padding:12px 16px; display:flex; align-items:center; justify-content:space-between;}
  header h1{margin:0; font-size:20px; display:flex; align-items:center;}
  
  #logoHeader{
    width:50px;
    height:50px;
    border-radius:50%;
    object-fit:cover;
    margin-right:10px;
  }

  nav a{display:inline-block; margin-left:8px; color:#fff; text-decoration:none; font-weight:bold; padding:8px 12px; border-radius:20px; transition:.2s;}
  nav a:hover{background:#fff; color:var(--rosa)}
  nav a.ativo{background:#fff; color:var(--rosa)}
  
  main{max-width:1200px; margin:86px auto 24px; padding:0 16px}
  #agendaMain{display:flex; gap:20px; align-items:flex-start}
  #calendario{flex:1; max-height:78vh; overflow-y:auto;}
  .mes{background:var(--card); border-radius:14px; padding:12px; margin-bottom:20px; box-shadow:var(--sombra);}
  .mes h2{margin:6px 0 12px; text-transform:capitalize; color:var(--rosa-escuro); text-align:center}
  .dias-semana{display:grid; grid-template-columns:repeat(7,1fr); margin-bottom:6px; text-align:center; font-weight:bold; font-size:12px;}
  .dias{display:grid; grid-template-columns:repeat(7,1fr); gap:6px;}
  .dia{background:#ffe6f0; border-radius:8px; min-height:86px; padding:6px; position:relative; font-size:12px;}
  .dia-num{font-weight:bold; opacity:.8}
  .dia.hoje{outline:2px solid var(--rosa-escuro); background:#ffd1e3}
  .badge{display:block; width:100%; text-align:left; border:none; border-radius:8px; color:#fff; padding:6px 8px; margin-top:6px; cursor:pointer; position:relative; font-size:12px; line-height:1.2; box-shadow:0 2px 6px rgba(0,0,0,.08);}
  .badge.avulso{background:var(--azul);}
  .badge.pacote{background:var(--verde);}
  .badge.cancelado_cliente{filter:grayscale(.2); text-decoration:line-through; opacity:.8}
  .badge.cancelado_sistema{filter:grayscale(1); opacity:.5; border:1px dashed #900}

  #sidebar{width:320px; background:var(--card); border-radius:14px; padding:16px; box-shadow:var(--sombra); position:sticky; top:92px;}
  #sidebar h3{margin-top:0; color:var(--rosa-escuro); text-align:center}
  .field{margin-bottom:10px}
  .field label{display:block; font-size:13px; margin-bottom:4px}
  .field input, .field select{width:100%; padding:10px; border:2px solid var(--rosa); border-radius:10px; background:#fff;}
  .btn{display:inline-block; width:100%; border:none; border-radius:10px; padding:10px 12px; font-weight:bold; cursor:pointer; transition:.2s; box-shadow:var(--sombra);}
  .btn:hover{transform:translateY(-1px)}
  .btn-avulso{background:var(--azul); color:#fff}
  .btn-pacote{background:var(--verde); color:#fff}

  #financeiroSec{display:none}
  .cards{display:flex; gap:16px; flex-wrap:wrap}
  .card{flex:1; min-width:220px; background:var(--card); border-radius:14px; padding:16px; text-align:center; box-shadow:var(--sombra);}
  .card h3{margin:6px 0 10px; color:var(--rosa-escuro)}
  table{width:100%; border-collapse:collapse; background:var(--card); border-radius:14px; overflow:hidden; box-shadow:var(--sombra); margin-top:16px;}
  th, td{padding:10px; border-bottom:1px solid #ffe6f0; text-align:left; font-size:14px}
  th{background:var(--rosa); color:#fff}
  tr:nth-child(even) td{background:#fff9fc}
  .t-actions button{margin:0 4px 4px 0}
  .mini{padding:6px 8px; border:none; border-radius:8px; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.08)}
  .mini.edit{background:#f0f7ff}

  .modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:2000;}
  .modal{width:100%; max-width:420px; background:var(--card); border-radius:14px; padding:16px; box-shadow:var(--sombra);}
  .modal h3{margin:0 0 12px; color:var(--rosa-escuro)}
  .modal .row{display:flex; gap:8px}
  .modal .row .field{flex:1}
  .modal .actions{display:flex; gap:8px; margin-top:12px}
  .modal .close-x{position:absolute; right:14px; top:14px; background:transparent; border:none; font-size:18px; cursor:pointer; color:#888;}

  #loginScreen{
    position:fixed; inset:0; background:rgba(255,255,255,0.95); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:3000;
  }
  #loginScreen h2{margin-bottom:20px; color:var(--rosa-escuro);}
  #loginScreen input{width:220px; padding:10px; margin:6px 0; border:2px solid var(--rosa); border-radius:10px;}
  #loginScreen button{width:100%; max-width:240px; padding:10px; margin-top:12px; background:var(--rosa); color:#fff; border:none; border-radius:10px; font-weight:bold; cursor:pointer;}
  #loginScreen #logoLogin{
    width:80px;
    height:80px;
    border-radius:50%;
    object-fit:cover;
    margin-bottom:12px;
  }

  .hidden{display:none !important}

/* ================= CSS RESPONSIVO ================= */
@media (max-width: 768px) {
  #agendaMain {
    flex-direction: column; /* calend√°rio e sidebar ficam um abaixo do outro */
  }

  #sidebar {
    width: 100%; /* sidebar ocupa toda a largura */
    position: static !important; /* remove sticky */
    top: auto;
    margin-top: 20px;
  }

  #calendario {
    max-height: none; /* permite rolar todo o calend√°rio */
    overflow-y: auto;
  }

  header .header-inner {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }

  nav a {
    padding: 6px 10px;
    font-size: 14px;
    margin-left: 0;
  }

  #loginScreen input, #loginScreen button {
    width: 90%;
    max-width: none;
  }

  .mes {
    padding: 8px;
  }

  .dia {
    min-height: 60px;
    font-size: 10px;
  }

  .badge {
    font-size: 10px;
    padding: 4px 6px;
  }

  .cards {
    flex-direction: column;
  }

  table, th, td {
    font-size: 12px;
  }
}
</style>
</head>
<body>

<div id="loginScreen">
  <img src="logo.png" alt="Logo" id="logoLogin">
  <h2>Login Est√©tica Animal</h2>
  <input type="text" id="loginUser" placeholder="Usu√°rio" />
  <input type="password" id="loginPass" placeholder="Senha" />
  <button onclick="fazerLogin()">Entrar</button>
</div>

<header>
  <div class="header-inner">
    <h1>
      <img src="logo.png" alt="Logo" id="logoHeader">
      üêæ Est√©tica Animal
    </h1>
    <nav>
      <a href="#" id="navAgenda" class="ativo" onclick="mostrarAgenda(event)">Agenda</a>
      <a href="#" id="navFinanceiro" onclick="mostrarFinanceiro(event)">Financeiro</a>
    </nav>
  </div>
</header>

<main>
<section id="agendaMain">
  <div id="calendario"></div>

  <aside id="sidebar">
    <h3>Adicionar Banho</h3>
    <div class="field">
      <label for="tipoBanho">Tipo</label>
      <select id="tipoBanho">
        <option value="avulso">Banho Avulso</option>
        <option value="pacote">Pacote (4 semanas)</option>
      </select>
    </div>
    <div class="field">
      <label for="tutor">Tutor</label>
      <input type="text" id="tutor" placeholder="Nome do Tutor" />
    </div>
    <div class="field">
      <label for="cliente">Cliente</label>
      <input type="text" id="cliente" placeholder="Nome do Cliente" />
    </div>
    <div class="field">
      <label for="dataBanho">Data</label>
      <input type="text" id="dataBanho" placeholder="Selecione a data"/>
    </div>
    <div class="field">
      <label for="horario">Hor√°rio</label>
      <input type="text" id="horario" placeholder="Selecione o hor√°rio"/>
    </div>
    <div class="field">
      <label for="valor">Valor
        <small style="opacity:.7;display:block">Pacote: coloque o valor TOTAL do pacote (dividiremos em 4)</small>
      </label>
      <input type="number" id="valor" step="0.01" min="0" placeholder="0,00" />
    </div>
    <button id="adicionarBtn" class="btn btn-avulso" onclick="adicionarBanho()">Adicionar</button>
    <button class="btn btn-avulso" style="margin-top:10px" onclick="limparHistorico()">Limpar Hist√≥rico</button>
  </aside>
</section>

<section id="financeiroSec">
  <div class="cards">
    <div class="card"><h3>Total do Dia</h3><div id="totalDia">R$ 0,00</div></div>
    <div class="card"><h3>Total do M√™s</h3><div id="totalMes">R$ 0,00</div></div>
    <div class="card"><h3>Ticket M√©dio</h3><div id="ticketMedio">R$ 0,00</div></div>
    <div class="card"><h3>Total de Clientes</h3><div id="totalClientes">0</div></div>
  </div>

  <h2 style="color:var(--rosa-escuro)">Banhos Registrados</h2>
  <table>
    <thead>
      <tr>
        <th>ID</th><th>Cliente</th><th>Tutor</th><th>Data</th><th>Hora</th><th>Valor</th><th>Tipo</th><th>Status</th><th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="listaBanhos"></tbody>
  </table>
</section>

<div id="modalBackdrop" class="modal-backdrop" onclick="fecharModal(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <button class="close-x" onclick="fecharModal()">√ó</button>
    <h3 id="modalTitulo">Agendamento</h3>
    <div class="row">
      <div class="field">
        <label>Data</label>
        <input type="text" id="modalData" placeholder="Selecione a data">
      </div>
      <div class="field">
        <label>Hora</label>
        <input type="text" id="modalHora" placeholder="Selecione o hor√°rio">
      </div>
    </div>
    <div class="row" style="margin-top:8px">
      <div class="field">
        <label>Valor</label>
        <input type="number" id="modalValor" step="0.01" min="0">
      </div>
      <div class="field">
        <label>Tipo</label>
        <input type="text" id="modalTipo" disabled>
      </div>
    </div>
    <div style="margin-top:8px;font-size:13px;opacity:.8" id="modalObs"></div>
    <div class="actions">
      <button class="mini edit" onclick="salvarEdicao()">üíæ Salvar</button>
      <button class="mini cancC" onclick="cancelarModal('cliente')">üö´ Cancelar (Cliente)</button>
      <button class="mini cancS" onclick="cancelarModal('sistema')">üõë Cancelar (Sistema)</button>
      <button class="mini revive hidden" id="btnReativar" onclick="reativarModal()">‚Ü©Ô∏è Reativar</button>
    </div>
  </div>
</div>

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
/* ================= LOGIN ================= */
const usuarios = [
  {user:'Kamilly', pass:'petshop2025'},
  {user:'Leocir', pass:'admin'}
];
function fazerLogin(){
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value.trim();
  const encontrado = usuarios.find(x=>x.user===u && x.pass===p);
  if(encontrado){
    document.getElementById('loginScreen').style.display='none';
    mostrarAgenda();
  } else {
    alert('Usu√°rio ou senha incorretos');
  }
}

/* ================= BASE DE DADOS ================= */
const LS_KEY='banhos';
const uid = () => Date.now().toString(36)+Math.random().toString(36).slice(2,8);
const loadBanhos=()=>{try{return JSON.parse(localStorage.getItem(LS_KEY))||[]}catch{return[]}};
const saveBanhos=(arr)=>localStorage.setItem(LS_KEY,JSON.stringify(arr));

/* ================= AGENDA & FINANCEIRO ================= */
function limparHistorico(){
  if(confirm('Deseja realmente limpar todo o hist√≥rico de banhos?')){
    localStorage.removeItem(LS_KEY);
    renderCalendario();
    renderFinanceiro();
  }
}
function setAtivo(id){
  document.querySelectorAll('nav a').forEach(a=>a.classList.remove('ativo'));
  document.getElementById(id).classList.add('ativo');
}
function mostrarAgenda(e){
  if(e) e.preventDefault();
  document.getElementById('agendaMain').style.display='flex';
  document.getElementById('financeiroSec').style.display='none';
  setAtivo('navAgenda');
  renderCalendario();
}
function mostrarFinanceiro(e){
  if(e) e.preventDefault();
  document.getElementById('agendaMain').style.display='none';
  document.getElementById('financeiroSec').style.display='block';
  setAtivo('navFinanceiro');
  renderFinanceiro();
}

/* ================= CALEND√ÅRIO ================= */
const nomesMeses=["janeiro","fevereiro","mar√ßo","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];
const nomesDias=["Seg","Ter","Qua","Qui","Sex","S√°b","Dom"];
let hoje = new Date();

function renderCalendario(){
  const calendario = document.getElementById('calendario');
  calendario.innerHTML='';
  const banhos = loadBanhos();

  for(let m=0;m<=1;m++){
    const mes = hoje.getMonth()+m;
    const ano = hoje.getFullYear();
    const primeiroDia = new Date(ano,mes,1);
    const ultimoDia = new Date(ano, mes+1,0);
    const diasMes = ultimoDia.getDate();
    const primeiroDiaSemana = (primeiroDia.getDay()+6)%7;

    const mesDiv = document.createElement('div');
    mesDiv.className='mes';
    mesDiv.innerHTML=`<h2>${nomesMeses[mes]}</h2>`;
    const diasSemanaDiv = document.createElement('div');
    diasSemanaDiv.className='dias-semana';
    nomesDias.forEach(d=>{diasSemanaDiv.innerHTML+=`<div>${d}</div>`});
    mesDiv.appendChild(diasSemanaDiv);

    const diasDiv = document.createElement('div');
    diasDiv.className='dias';

    for(let i=0;i<primeiroDiaSemana;i++){
      const diaVazio = document.createElement('div');
      diaVazio.className='dia';
      diasDiv.appendChild(diaVazio);
    }

    for(let d=1; d<=diasMes; d++){
      const diaData = new Date(ano,mes,d);
      const diaDiv = document.createElement('div');
      diaDiv.className='dia';
      if(diaData.toDateString()===hoje.toDateString()) diaDiv.classList.add('hoje');
      diaDiv.innerHTML=`<div class="dia-num">${d}</div>`;
      
      banhos.filter(b=>b.data===diaData.toISOString().split('T')[0])
            .forEach(b=>{
              const btn = document.createElement('button');
              btn.className=`badge ${b.tipo}`;
              if(b.status==='cancelado_cliente') btn.className+=' cancelado_cliente';
              if(b.status==='cancelado_sistema') btn.className+=' cancelado_sistema';
              btn.innerText=`${b.cliente} ${b.hora}`;
              btn.onclick=()=>abrirModal(b);
              diaDiv.appendChild(btn);
            });

      diasDiv.appendChild(diaDiv);
    }
    mesDiv.appendChild(diasDiv);
    calendario.appendChild(mesDiv);
  }
}

/* ================= ADICIONAR BANHO ================= */
function adicionarBanho(){
  const tipo = document.getElementById('tipoBanho').value;
  const tutor = document.getElementById('tutor').value.trim();
  const cliente = document.getElementById('cliente').value.trim();
  const data = document.getElementById('dataBanho').value;
  const hora = document.getElementById('horario').value;
  const valor = parseFloat(document.getElementById('valor').value) || 0;
  if(!tutor||!cliente||!data||!hora){alert('Preencha todos os campos'); return;}
  const banho = {id:uid(), tipo,tutor,cliente,data,hora,valor,status:'ativo'};
  const banhos = loadBanhos();
  banhos.push(banho);
  saveBanhos(banhos);
  renderCalendario();
  renderFinanceiro();
}

/* ================= MODAL ================= */
function abrirModal(banho){
  document.getElementById('modalBackdrop').style.display='flex';
  document.getElementById('modalTitulo').innerText=`Agendamento - ${banho.cliente}`;
  document.getElementById('modalData')._flatpickr.setDate(banho.data);
  document.getElementById('modalHora')._flatpickr.setDate(banho.hora,false,'H:i');
  document.getElementById('modalValor').value=banho.valor;
  document.getElementById('modalTipo').value=banho.tipo;
  window.modalBanho=banho;
  document.getElementById('btnReativar').classList.toggle('hidden', banho.status==='ativo');
}
function fecharModal(e){document.getElementById('modalBackdrop').style.display='none';}
function cancelarModal(tipo){
  if(!window.modalBanho) return;
  const banhos = loadBanhos();
  const idx = banhos.findIndex(b=>b.id===window.modalBanho.id);
  if(idx===-1) return;
  if(tipo==='cliente') banhos[idx].status='cancelado_cliente';
  else if(tipo==='sistema') banhos[idx].status='cancelado_sistema';
  saveBanhos(banhos);
  renderCalendario();
  renderFinanceiro();
  fecharModal();
}
function reativarModal(){
  if(!window.modalBanho) return;
  const banhos = loadBanhos();
  const idx = banhos.findIndex(b=>b.id===window.modalBanho.id);
  if(idx===-1) return;
  banhos[idx].status='ativo';
  saveBanhos(banhos);
  renderCalendario();
  renderFinanceiro();
  fecharModal();
}
function salvarEdicao(){
  if(!window.modalBanho) return;
  const banhos = loadBanhos();
  const idx = banhos.findIndex(b=>b.id===window.modalBanho.id);
  if(idx===-1) return;
  banhos[idx].data=document.getElementById('modalData').value;
  banhos[idx].hora=document.getElementById('modalHora').value;
  banhos[idx].valor=parseFloat(document.getElementById('modalValor').value)||0;
  saveBanhos(banhos);
  renderCalendario();
  renderFinanceiro();
  fecharModal();
}

/* ================= FINANCEIRO ================= */
function renderFinanceiro(){
  const banhos = loadBanhos();
  const hojeStr = hoje.toISOString().split('T')[0];
  const totalDia = banhos.filter(b=>b.data===hojeStr && b.status==='ativo').reduce((s,b)=>s+b.valor,0);
  const totalMes = banhos.filter(b=>b.data.startsWith(`${hoje.getFullYear()}-${String(hoje.getMonth()+1).padStart(2,'0')}`) && b.status==='ativo').reduce((s,b)=>s+b.valor,0);
  const clientes = [...new Set(banhos.filter(b=>b.status==='ativo').map(b=>b.cliente))];
  const ticketMedio = totalMes/clientes.length||0;

  document.getElementById('totalDia').innerText=`R$ ${totalDia.toFixed(2)}`;
  document.getElementById('totalMes').innerText=`R$ ${totalMes.toFixed(2)}`;
  document.getElementById('ticketMedio').innerText=`R$ ${ticketMedio.toFixed(2)}`;
  document.getElementById('totalClientes').innerText=clientes.length;

  const tbody = document.getElementById('listaBanhos');
  tbody.innerHTML='';
  banhos.forEach((b,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${b.cliente}</td>
      <td>${b.tutor}</td>
      <td>${b.data}</td>
      <td>${b.hora}</td>
      <td>R$ ${b.valor.toFixed(2)}</td>
      <td>${b.tipo}</td>
      <td>${b.status}</td>
      <td class="t-actions">
        <button class="mini edit" onclick="abrirModal(loadBanhos().find(x=>x.id==='${b.id}'))">‚úèÔ∏è</button>
        <button class="mini" onclick="cancelarModal('cliente')">üö´</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

/* ================= FLATPICKR ================= */
flatpickr("#dataBanho", { dateFormat: "Y-m-d" });
flatpickr("#modalData", { dateFormat: "Y-m-d" });
flatpickr("#horario", { enableTime: true, noCalendar: true, dateFormat: "H:i" });
flatpickr("#modalHora", { enableTime: true, noCalendar: true, dateFormat: "H:i" });

</script>
</body>
</html>
