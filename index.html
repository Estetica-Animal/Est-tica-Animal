<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Estética Animal — Agenda & Tutores</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{
  --rosa:#ff66a3;
  --rosa-escuro:#ff3385;
  --bg:#fff0f6;
  --card:#ffffff;
  --texto:#444;
  --sombra:0 4px 8px rgba(255,102,163,.3);
  --azul:#007bff;
  --verde:#28a745;
  --cinza:#d6d6d6;
}
*{box-sizing:border-box}
body{font-family:Arial,Helvetica,sans-serif; background:var(--bg); color:var(--texto); margin:0;}

header{
  position:fixed; top:0; left:0; right:0; background:var(--rosa); color:#fff; z-index:1000; box-shadow:var(--sombra);
}
.header-inner{
  max-width:1200px; margin:0 auto; padding:12px 16px; display:flex; align-items:center; justify-content:space-between;
}
header h1{
  margin:0; font-size:20px; display:flex; align-items:center; gap:10px;
}
#logoHeader{width:40px;height:40px;border-radius:50%;object-fit:cover;}
nav{display:flex; gap:20px; justify-content:center; align-items:center; flex:1;}
nav a{display:inline-block; color:#fff; text-decoration:none; font-weight:bold; padding:8px 12px; border-radius:20px; transition:.2s;}
nav a:hover{background:#fff; color:var(--rosa)}
nav a.ativo{background:#fff; color:var(--rosa)}

main{max-width:1200px; margin:0 auto 24px; padding:100px 16px 24px 16px;}

/* ======= AGENDA ======= */
#agendaMain{display:flex; gap:20px; align-items:flex-start}
#calendario{flex:1; max-height:78vh; overflow-y:auto;}
.mes{background:var(--card); border-radius:14px; padding:12px; margin-bottom:20px; box-shadow:var(--sombra);}
.mes h2{margin:6px 0 12px; text-transform:capitalize; color:var(--rosa-escuro); text-align:center}
.dias-semana{display:grid; grid-template-columns:repeat(7,1fr); margin-bottom:6px; text-align:center; font-weight:bold; font-size:12px;}
.dias{display:grid; grid-template-columns:repeat(7,1fr); gap:6px;}
.dia{background:#ffe6f0; border-radius:8px; min-height:86px; padding:6px; position:relative; font-size:12px;}
.dia-num{font-weight:bold; opacity:.8}
.dia.hoje{outline:2px solid var(--rosa-escuro); background:#ffd1e3}
.badge{display:block; width:100%; text-align:left; border:none; border-radius:8px; color:#fff; padding:6px 8px; margin-top:6px; cursor:pointer; font-size:12px; line-height:1.2; box-shadow:0 2px 6px rgba(0,0,0,.08);}
.badge.avulso{background:var(--azul)}
.badge.pacote{background:var(--verde)}

#sidebar{width:320px; background:var(--card); border-radius:14px; padding:16px; box-shadow:var(--sombra); position:sticky; top:92px;}
#sidebar h3{margin-top:0; color:var(--rosa-escuro); text-align:center}
.field{margin-bottom:10px}
.field label{display:block; font-size:13px; margin-bottom:4px}
.field input, .field select{width:100%; padding:10px; border:2px solid var(--rosa); border-radius:10px; background:#fff;}
.btn{display:inline-block; width:100%; border:none; border-radius:10px; padding:10px 12px; font-weight:bold; cursor:pointer; transition:.2s; box-shadow:var(--sombra);}
.btn:hover{transform:translateY(-1px)}
.btn-avulso{background:var(--azul); color:#fff}

/* ======= TUTORES ======= */
#tutoresSec{display:none; display:grid; grid-template-columns:1fr; gap:20px;}
#formTutor, #formAnimal, #listaTutores{background:var(--card); padding:16px; border-radius:14px; box-shadow:var(--sombra);}
#listaTutores h3{margin-top:0; color:var(--rosa-escuro);}
.tutor-card{border-bottom:1px solid #eee; padding:10px 0; display:flex; flex-direction:column; gap:6px;}
.tutor-card span{font-size:14px;}
.animal{display:flex; align-items:center; gap:10px; margin-top:6px; justify-content:space-between;}
.animal img{width:40px; height:40px; border-radius:50%; object-fit:cover;}
.edit-icon{cursor:pointer; color:var(--rosa-escuro); margin-left:6px;}
.edit-icon:hover{color:var(--rosa);}

/* ======= LOGIN ======= */
#loginScreen{position:fixed; inset:0; background:rgba(255,255,255,0.95); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:3000;}
#loginScreen h2{margin-bottom:20px; color:var(--rosa-escuro);}
#loginScreen input{width:220px; padding:10px; margin:6px 0; border:2px solid var(--rosa); border-radius:10px;}
#loginScreen button{width:100%; max-width:240px; padding:10px; margin-top:12px; background:var(--rosa); color:#fff; border:none; border-radius:10px; font-weight:bold; cursor:pointer;}
#loginScreen #logoLogin{width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:12px;}
</style>
</head>
<body>

<div id="loginScreen">
  <img src="logo.png" alt="Logo" id="logoLogin">
  <h2>Login Estética Animal</h2>
  <input type="text" id="loginUser" placeholder="Usuário" />
  <input type="password" id="loginPass" placeholder="Senha" />
  <button onclick="fazerLogin()">Entrar</button>
</div>

<header>
  <div class="header-inner">
    <h1><img src="logo.png" alt="Logo" id="logoHeader"> Estética Animal</h1>
    <nav>
      <a href="#" id="navAgenda" class="ativo" onclick="mostrarAgenda(event)">Agenda</a>
      <a href="#" id="navTutores" onclick="mostrarTutores(event)">Controle de Tutores</a>
    </nav>
  </div>
</header>

<main>
  <!-- ======= AGENDA ======= -->
  <section id="agendaMain">
    <div id="calendario"></div>
    <aside id="sidebar">
      <h3>Adicionar Banho</h3>
      <div class="field"><label>Tipo</label>
        <select id="tipoBanho" onchange="togglePacoteOptions()">
          <option value="avulso">Avulso</option>
          <option value="pacote">Pacote</option>
        </select>
      </div>
      <div class="field" id="pacoteOptions" style="display:none">
        <label>Pacote</label>
        <select id="pacoteSelecionado">
          <option value="3">Pacote 3 banhos (1x por semana / 3 semanas)</option>
          <option value="4">Pacote 4 banhos (1x por semana / 4 semanas)</option>
        </select>
      </div>
      <div class="field"><label for="tutorSelect">Tutor</label>
        <select id="tutorSelect" onchange="carregarAnimais()">
          <option value="">Selecione um tutor</option>
        </select>
      </div>
      <div class="field"><label for="animalSelect">Cliente</label>
        <select id="animalSelect">
          <option value="">Selecione um cliente</option>
        </select>
      </div>
      <div class="field"><label for="dataBanho">Data</label><input type="date" id="dataBanho" /></div>
      <div class="field"><label for="horario">Horário</label><input type="time" id="horario" /></div>
      <div class="field"><label for="valor">Valor</label><input type="number" id="valor" step="0.01" min="0" /></div>
      <button class="btn btn-avulso" onclick="adicionarBanho()">Adicionar</button>
    </aside>
  </section>

  <!-- ======= CONTROLE DE TUTORES ======= -->
  <section id="tutoresSec">
    <div id="formTutor">
      <h3>Cadastrar Tutor</h3>
      <input type="text" id="tutorNome" placeholder="Nome completo" /><br>
      <input type="text" id="tutorEndereco" placeholder="Endereço" /><br>
      <input type="text" id="tutorTelefone" placeholder="Telefone" /><br>
      <button class="btn btn-avulso" onclick="adicionarTutor()">Salvar Tutor</button>
    </div>
    <div id="formAnimal">
      <h3>Adicionar Cliente</h3>
      <select id="animalTutor"></select><br>
      <input type="text" id="animalNome" placeholder="Nome do Cliente" /><br>
      <input type="file" id="animalFoto" accept="image/*" /><br>
      <button class="btn btn-avulso" onclick="adicionarAnimal()">Salvar Cliente</button>
    </div>
    <div id="listaTutores">
      <h3>Tutores Registrados</h3>
      <div id="tutoresContainer"></div>
    </div>
  </section>
</main>

<script>
/* LOGIN */
const usuarios = [
  { user: 'kamilly', pass: 'petshop2025' },
  { user: 'leocir', pass: 'admin' }
];

function fazerLogin() {
  const u = document.getElementById('loginUser').value.trim().toLowerCase();
  const p = document.getElementById('loginPass').value.trim();

  const ok = usuarios.find(x => x.user === u && x.pass === p);

  if (ok) {
    document.getElementById('loginScreen').style.display = 'none';
    mostrarAgenda();
    document.getElementById('loginUser').value = '';
    document.getElementById('loginPass').value = '';
  } else {
    alert('Usuário ou senha incorretos');
  }
}


/* STORAGE */
const LS_TUTORES='tutores';
const LS_BANHOS='banhos';
const uid=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,8);
const load=(k)=>JSON.parse(localStorage.getItem(k)||'[]');
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));

/* NAV */
function setAtivo(id){document.querySelectorAll('nav a').forEach(a=>a.classList.remove('ativo'));document.getElementById(id).classList.add('ativo');}
function mostrarAgenda(e){if(e)e.preventDefault();document.getElementById('agendaMain').style.display='flex';document.getElementById('tutoresSec').style.display='none';setAtivo('navAgenda');renderCalendario();atualizarTutoresSelect();}
function mostrarTutores(e){if(e)e.preventDefault();document.getElementById('agendaMain').style.display='none';document.getElementById('tutoresSec').style.display='grid';setAtivo('navTutores');renderTutores();}

/* CALENDÁRIO: mês atual + próximo */
function renderCalendario(){
  const calendario=document.getElementById('calendario');
  calendario.innerHTML='';
  const hoje=new Date();
  const banhos=load(LS_BANHOS);
  
  for(let i=0;i<2;i++){
    const data=new Date(hoje.getFullYear(),hoje.getMonth()+i,1);
    const mes=data.toLocaleString('pt-BR',{month:'long',year:'numeric'});
    const mesDiv=document.createElement('div');
    mesDiv.className='mes';
    mesDiv.innerHTML=`<h2>${mes}</h2>
      <div class="dias-semana">
        <div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sáb</div><div>Dom</div>
      </div>`;
    
    const diasDiv=document.createElement('div');
    diasDiv.className='dias';

    const primeiroDia=(data.getDay()+6)%7; // segunda=0
    for(let j=0;j<primeiroDia;j++){ diasDiv.innerHTML+='<div></div>'; }

    const ultimoDia=new Date(data.getFullYear(),data.getMonth()+1,0).getDate();
    for(let d=1;d<=ultimoDia;d++){
      const dia=document.createElement('div');
      dia.className='dia';
      if(d===hoje.getDate() && i===0) dia.classList.add('hoje');
      dia.innerHTML=`<div class="dia-num">${d}</div>`;

      const diaStr=`${data.getFullYear()}-${String(data.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      banhos.filter(b=>b.data===diaStr).forEach(b=>{
        const badge=document.createElement('button');
        badge.className='badge '+b.tipo;
        badge.textContent=`${getAnimalNome(b.animalId)} (${b.horario})`;
        dia.appendChild(badge);
      });

      diasDiv.appendChild(dia);
    }

    mesDiv.appendChild(diasDiv);
    calendario.appendChild(mesDiv);
  }
}

/* AUX: nome do animal */
function getAnimalNome(animalId){
  const tutores=load(LS_TUTORES);
  for(const t of tutores){
    const a=t.animais.find(x=>x.id===animalId);
    if(a) return a.nome;
  }
  return 'Cliente';
}

/* PACOTE */
function togglePacoteOptions(){
  const tipo=document.getElementById('tipoBanho').value;
  document.getElementById('pacoteOptions').style.display=(tipo==='pacote')?'block':'none';
}

/* TUTORES */
function adicionarTutor(){
  const nome=document.getElementById('tutorNome').value.trim();
  const endereco=document.getElementById('tutorEndereco').value.trim();
  const tel=document.getElementById('tutorTelefone').value.trim();
  if(!nome) return alert('Informe o nome');
  const tutores=load(LS_TUTORES);
  tutores.push({id:uid(),nome,endereco,tel,animais:[]});
  save(LS_TUTORES,tutores);
  document.getElementById('tutorNome').value='';
  document.getElementById('tutorEndereco').value='';
  document.getElementById('tutorTelefone').value='';
  renderTutores(); atualizarTutoresSelect();
}
function adicionarAnimal(){
  const tutorId=document.getElementById('animalTutor').value;
  const nome=document.getElementById('animalNome').value.trim();
  const file=document.getElementById('animalFoto').files[0];
  if(!tutorId) return alert('Selecione um tutor');
  if(!nome) return alert('Informe o nome do cliente');
  if(file){
    const reader=new FileReader();
    reader.onload=e=> salvarAnimal(tutorId,nome,e.target.result);
    reader.readAsDataURL(file);
  } else salvarAnimal(tutorId,nome,'');
}
function salvarAnimal(tutorId,nome,foto){
  const tutores=load(LS_TUTORES);
  const t=tutores.find(x=>x.id===tutorId);
  if(!t) return;
  t.animais.push({id:uid(),nome,foto});
  save(LS_TUTORES,tutores);
  document.getElementById('animalNome').value='';
  document.getElementById('animalFoto').value='';
  renderTutores(); atualizarTutoresSelect();
}
function renderTutores(){
  const tutores=load(LS_TUTORES);
  const container=document.getElementById('tutoresContainer');
  const sel=document.getElementById('animalTutor');
  container.innerHTML='';
  sel.innerHTML='<option value="">Selecione um Tutor</option>';
  tutores.forEach(t=>{
    sel.innerHTML+=`<option value="${t.id}">${t.nome}</option>`;
    const div=document.createElement('div');
    div.className='tutor-card';
    div.innerHTML=`<strong>${t.nome}</strong><br>${t.endereco} - ${t.tel}`;
    const btnEditar=document.createElement('i'); btnEditar.className="fa-solid fa-pencil edit-icon"; btnEditar.onclick=()=>alert('Editar Tutor: '+t.nome);
    const btnExcluir=document.createElement('i'); btnExcluir.className="fa-solid fa-trash edit-icon"; btnExcluir.onclick=()=>excluirTutor(t.id);
    div.appendChild(btnEditar); div.appendChild(btnExcluir);
    t.animais.forEach(a=>{
      const an=document.createElement('div'); an.className='animal';
      an.innerHTML=`${a.foto?`<img src="${a.foto}">`:''}<span>${a.nome}</span>`;
      const editAni=document.createElement('i'); editAni.className="fa-solid fa-pencil edit-icon"; editAni.onclick=()=>alert('Editar Animal: '+a.nome);
      const delAni=document.createElement('i'); delAni.className="fa-solid fa-trash edit-icon"; delAni.onclick=()=>excluirAnimal(t.id,a.id);
      an.appendChild(editAni); an.appendChild(delAni);
      div.appendChild(an);
    });
    container.appendChild(div);
  });
}
function excluirTutor(id){if(!confirm('Excluir tutor e seus clientes?')) return;let tutores=load(LS_TUTORES);tutores=tutores.filter(t=>t.id!==id);save(LS_TUTORES,tutores);renderTutores();atualizarTutoresSelect();}
function excluirAnimal(tutorId,animalId){let tutores=load(LS_TUTORES);const t=tutores.find(x=>x.id===tutorId);if(t){t.animais=t.animais.filter(a=>a.id!==animalId);}save(LS_TUTORES,tutores);renderTutores();atualizarTutoresSelect();}
function atualizarTutoresSelect(){
  const tutores=load(LS_TUTORES);
  const sel=document.getElementById('tutorSelect');
  sel.innerHTML='<option value="">Selecione um tutor</option>';
  tutores.forEach(t=>{sel.innerHTML+=`<option value="${t.id}">${t.nome}</option>`;});
}
function carregarAnimais(){
  const tutorId=document.getElementById('tutorSelect').value;
  const tutores=load(LS_TUTORES);
  const t=tutores.find(x=>x.id===tutorId);
  const sel=document.getElementById('animalSelect');
  sel.innerHTML='<option value="">Selecione um cliente</option>';
  if(t){t.animais.forEach(a=>{sel.innerHTML+=`<option value="${a.id}">${a.nome}</option>`;});}
}

/* BANHOS */
function adicionarBanho(){
  const tipo=document.getElementById('tipoBanho').value;
  const tutorId=document.getElementById('tutorSelect').value;
  const animalId=document.getElementById('animalSelect').value;
  const data=document.getElementById('dataBanho').value;
  const horario=document.getElementById('horario').value;
  const valor=document.getElementById('valor').value;

  if(!tutorId||!animalId||!data||!horario) return alert('Preencha todos os campos');

  const banhos=load(LS_BANHOS);
  const pacoteId = uid();

  if(tipo==='avulso'){
    banhos.push({id:uid(),pacoteId,tipo,tutorId,animalId,data,horario,valor});
  } else {
    const qtd=parseInt(document.getElementById('pacoteSelecionado').value);
    let dt=new Date(data+"T00:00"); // força meia-noite local
    for(let i=0;i<qtd;i++){
      const str=`${dt.getFullYear()}-${String(dt.getMonth()+1).padStart(2,'0')}-${String(dt.getDate()).padStart(2,'0')}`;
      banhos.push({id:uid(),pacoteId,tipo,tutorId,animalId,data:str,horario,valor});
      dt.setDate(dt.getDate()+7); // próximo banho semanal
    }
  }
  save(LS_BANHOS,banhos);
  renderCalendario();

  // limpa
  document.getElementById('dataBanho').value='';
  document.getElementById('horario').value='';
  document.getElementById('valor').value='';
}

/* RENDERIZA BANHOS NO CALENDÁRIO */
function renderCalendario(){
  const calendario=document.getElementById('calendario');
  calendario.innerHTML='';
  const hoje=new Date();
  const ano=hoje.getFullYear(), mes=hoje.getMonth();

  for(let m=0;m<2;m++){ // mês atual e próximo
    const data=new Date(ano,mes+m,1);
    const nomeMes=data.toLocaleString('pt-BR',{month:'long'});
    const dias=new Date(ano,mes+m+1,0).getDate();

    const mesDiv=document.createElement('div');
    mesDiv.className='mes';
    mesDiv.innerHTML=`<h2>${nomeMes} ${data.getFullYear()}</h2>`;

    const head=document.createElement('div');
    head.className='dias-semana';
    head.innerHTML='<div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sáb</div><div>Dom</div>';
    mesDiv.appendChild(head);

    const grid=document.createElement('div');
    grid.className='dias';

    // calcular dia da semana do 1º dia (0=Domingo…6=Sábado → queremos 1=Seg)
    let start=(new Date(ano,mes+m,1).getDay()+6)%7;
    for(let i=0;i<start;i++) grid.appendChild(document.createElement('div'));

    const banhos=load(LS_BANHOS);

    for(let d=1;d<=dias;d++){
      const cell=document.createElement('div');
      cell.className='dia';
      const num=document.createElement('div');
      num.className='dia-num';
      num.innerText=d;
      cell.appendChild(num);

      const dataStr=`${ano}-${String(mes+m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;

      banhos.filter(b=>b.data===dataStr).forEach(b=>{
        const btn=document.createElement('button');
        btn.className='badge '+(b.tipo==='pacote'?'pacote':'avulso');
        btn.innerText=`${buscarAnimal(b.animalId)}\n${b.horario}`;
        btn.onclick=()=>gerenciarBanho(b);
        cell.appendChild(btn);
      });

      grid.appendChild(cell);
    }
    mesDiv.appendChild(grid);
    calendario.appendChild(mesDiv);
  }
}

/* AUXILIAR – nome do animal */
function buscarAnimal(id){
  const tutores=load(LS_TUTORES);
  for(const t of tutores){
    const a=t.animais.find(x=>x.id===id);
    if(a) return a.nome;
  }
  return "Cliente";
}

/* EDITAR/EXCLUIR BANHO */
function gerenciarBanho(b){
  const escolha=prompt("Digite:\n1 - Editar horário\n2 - Excluir este banho\n3 - Excluir pacote inteiro");
  if(escolha==="1"){
    const novo=prompt("Novo horário (HH:MM):",b.horario);
    if(novo){
      let banhos=load(LS_BANHOS);
      banhos=banhos.map(x=>x.id===b.id?{...x,horario:novo}:x);
      save(LS_BANHOS,banhos);
    }
  } else if(escolha==="2"){
    let banhos=load(LS_BANHOS).filter(x=>x.id!==b.id);
    save(LS_BANHOS,banhos);
  } else if(escolha==="3"){
    let banhos=load(LS_BANHOS).filter(x=>x.pacoteId!==b.pacoteId);
    save(LS_BANHOS,banhos);
  }
  renderCalendario();
}

</script>

</body>
</html>


